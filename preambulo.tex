% ===================================================================
% ARQUIVO DE PREÂMBULO
% Contém todas as configurações de pacotes e layout para o livro.
% ===================================================================


% --- CONFIGURAÇÕES ESSENCIAIS DO DOCUMENTO ---

% Codificacao da fonte. Essencial para a correta exibição de caracteres acentuados no PDF.
\usepackage[T1]{fontenc}

% Codificacao de entrada do arquivo .tex. Permite que você escreva com acentos diretamente.
\usepackage[utf8]{inputenc}

% Suporte ao idioma Português do Brasil.
% A classe abntex2 já cuida disso, mas é uma boa prática garantir.
% A opção 'brazil' ajusta hifenizacao, nomes de seções ("Sumário"), etc.
\usepackage[brazil]{babel}

% Para usar a fonte Palatino
\usepackage{mathpazo}

% --- PACOTES PARA CONTEÚDO TÉCNICO E MATEMÁTICO ---

% Pacotes padrao e essenciais para matemática avançada.
\usepackage{amsmath, amsfonts, amssymb}

% Pacote para inclusão de imagens.
\usepackage{graphicx}
% Define um ou mais diretórios padrão para suas imagens.
% Isso evita que você precise digitar "imagens/" toda vez.
\graphicspath{ {./imagens/} }

% Pacote para formatar e incluir snippets de código-fonte.
\usepackage{listings}
\usepackage{xcolor} % Necessário para definir cores no listings

% Define um estilo customizado para código Python, para ficar mais bonito.
\lstdefinestyle{PythonStyle}{
    language=Python,
    backgroundcolor=\color{gray!10},   % Cor de fundo leve
    basicstyle=\ttfamily\small,       % Fonte monoespaçada e pequena
    keywordstyle=\color{blue},        % Palavras-chave em azul
    commentstyle=\color{green!50!black},% Comentários em verde escuro
    stringstyle=\color{purple},       % Strings em roxo
    breaklines=true,                  % Quebra de linhas longas
    showstringspaces=false,           % Não mostra espaços em strings com um símbolo
    frame=single,                     % Adiciona uma moldura
    rulecolor=\color{black!30},       % Cor da moldura
    numbers=left,                     % Numeração de linhas à esquerda
    numberstyle=\tiny\color{gray},    % Estilo dos números de linha
}


% --- REFERÊNCIAS, CITAÇÕES E LINKS (PADRÃO ABNT) ---

% O sistema moderno e mais poderoso para bibliografia em LaTeX, já configurado para ABNT.
\usepackage[
    backend=biber,     % Ferramenta que processa a bibliografia (mais moderna que bibtex)
    style=abnt,        % Estilo de citação e referência da ABNT
    ittitles,          % Títulos de artigos, livros, etc., em itálico
    backref=true,      % Nas referências, mostra em quais páginas a citação aparece
]{biblatex}

\renewcommand*{\mkbibnamefamily}[1]{\MakeUppercase{#1}}
\renewcommand*{\mkbibnamelast}[1]{\MakeUppercase{#1}}

% Aponta para o arquivo que contém seu banco de dados de referências.
\addbibresource{bibliografia.bib}

% Melhora a formatação de URLs nas referências.
\usepackage{url}
\urlstyle{same} % Usa a mesma fonte do texto para as URLs.

% --- LAYOUT E ESTRUTURA ---

% Pacote para ajustar as margens e geometria da página.
% A classe abntex2 já define margens padrão ABNT, use para sobrescrever se necessário.
\usepackage{geometry}
\geometry{
    a4paper,
    left=3cm,
    right=2cm,
    top=3cm,
    bottom=2cm
}

% --- CONFIGURAÇÃO DO HYPERREF ---
% A classe abntex2 já carrega o pacote hyperref.
% Apenas usamos \hypersetup para definir as opções que queremos.

\hypersetup{
    pdftitle={O Título do Seu Livro},
    pdfauthor={Seu Nome},
    pdfsubject={Assunto do Livro},
    pdfkeywords={Palavra-chave1, Palavra-chave2},
    colorlinks=true,                % Habilita links coloridos
    linkcolor=blue,                 % Cor dos links internos (sumário, etc.)
    citecolor=red,                  % Cor das citações
    urlcolor=cyan,                  % Cor das URLs
    hidelinks=false,                % Se 'true', esconde as caixas e cores (bom para impressão)
    pdfstartview={FitH},            % Abre o PDF ajustado à largura da página
    bookmarksopen=true              % Abre o painel de bookmarks (índices)
}

% Pacote para customização avançada de cabeçalhos e rodapés.
% Descomente as linhas abaixo apenas se precisar de um layout diferente
% do padrão oferecido pelo abntex2.
%
% \usepackage{fancyhdr}
% \pagestyle{fancy}
% \fancyhf{} % Limpa todos os campos
% \fancyhead[LE,RO]{\nouppercase{\leftmark}} % Nome do capítulo no cabeçalho
% \fancyfoot[LE,RO]{\thepage} % Número da página no rodapé


% --- COMANDOS CUSTOMIZADOS (OPCIONAL) ---
% Aqui você pode definir seus próprios comandos para agilizar a escrita.
% Exemplo:
% \newcommand{\keras}{\texttt{Keras}}

\usepackage{tikz}
\usetikzlibrary{patterns, positioning, fit, shapes.geometric, arrows.meta, fpu, decorations.pathmorphing, shadows, shapes.symbols}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}

% --- Definindo as cores (hues) ---
\definecolor{darkblue}{rgb}{0.16, 0.32, 0.75}
\definecolor{darkorange}{rgb}{0.9, 0.35, 0.0}
\definecolor{pointred}{rgb}{0.85, 0.2, 0.2}

\usepackage[most]{tcolorbox}
\tcbuselibrary{skins} % Necessário para o estilo enhanced

\newtcolorbox{definicaomoderna}{
    enhanced,
    frame hidden, % Remove a moldura da caixa
    borderline west={2pt}{0pt}{gray!80}, % Cria uma linha de 2pt à esquerda (west)
    colback=gray!5, % Um fundo cinza muito sutil para diferenciar
    fonttitle=\bfseries,
    coltitle=black,
    sharp corners, % Cantos retos
    boxsep=5pt,
    left=10pt, % Espaço interno à esquerda
    attach boxed title to top left={yshift=-2mm, xshift=5mm}, % Posição do título
    boxed title style={
        frame hidden,
        colback=gray!5 % Fundo do título igual ao da caixa
    },
}

% --- Comando especial para equação destacada COM NOME ---
\newtcolorbox{equacaodestaque}[1]{ % O [1] indica que o comando aceita um argumento
    enhanced, ams equation,
    frame hidden,
    borderline west={2pt}{0pt}{gray!80},
    colback=gray!5,
    sharp corners,
    % --- Opções para o título ---
    fonttitle=\bfseries,
    coltitle=black,
    attach boxed title to top left={yshift=-2mm, xshift=5mm}, % Posiciona o título
    boxed title style={
        frame hidden,
        colback=gray!5 % Faz o fundo do título ser igual ao da caixa
    },
    title={#1} % Usa o argumento como título da caixa
}

\usepackage{xcolor} % Para definir cores customizadas
\usepackage{listings} % Para formatar o código
\usepackage[most]{tcolorbox} % Para criar a caixa estilizada
\usepackage{witharrows}

% --- 1. Definição das Cores para o Código ---
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{codeblue}{rgb}{0,0,0.8}
\definecolor{codered}{rgb}{0.8,0,0}

% --- 2. Configuração Global do Pacote listings ---
\lstset{
    language=Python,
    backgroundcolor=\color{white},   
    commentstyle=\color{codegray}\itshape,
    keywordstyle=\color{codeblue}\bfseries,
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codered},
    basicstyle=\ttfamily\small,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=4
}

% --- Criação do Ambiente de Listagem de Código Estilizado (Fundo Branco) ---
\newtcblisting{codelisting}[2]{
  listing only,
  enhanced,
  colback=white,  % Fundo branco, igual ao da página
  colframe=gray!80,
  frame hidden,
  borderline west={2pt}{0pt}{gray!80},
  sharp corners,
  top=5pt,
  bottom=5pt,
  % --- Título e numeração (Listagem X: Título) ---
  fonttitle=\bfseries,
  coltitle=black,
  title={Bloco de Código~\thetcbcounter: #1},
  label={lst:#2},
  % --- Opções passadas para o pacote listings ---
  listing options={
    language=Python,
    numbers=left,
  }
}

\usepackage{algorithm} % Para o ambiente algorithm
\usepackage{algpseudocode} % Para os comandos do pseudocódigo

\algrenewcommand\algorithmicrequire{\textbf{Requer:}}
\algrenewcommand\algorithmicreturn{\textbf{Retorne:}}

\usepackage{threeparttable}

\usepackage{longtable}     % Para tabelas que ocupam várias páginas
\usepackage{booktabs}      % Para as linhas \toprule, \midrule, \bottomrule
\usepackage{amsmath}       % Para os ambientes matemáticos como 'cases'
\usepackage[labelfont=bf, singlelinecheck=false, labelsep=endash]{caption} % Para formatar o título

\usepackage{makecell}

\numberwithin{figure}{chapter}
\numberwithin{table}{chapter}
\numberwithin{equation}{chapter}

\usepackage{nomencl}
\usepackage{etoolbox} % Para customizações avançadas

% --- Comandos Customizados para Funções ---
\newcommand{\fativ}[1]{\ensuremath{\mathcal{A}_{#1}}}
\newcommand{\fperd}[1]{\ensuremath{\mathcal{L}_{#1}}}

\usepackage{ragged2e}   % Para um melhor alinhamento do texto justificado

\usepackage{titling}

\usepackage{subcaption}

\usepackage{mathrsfs}
\newsavebox\foobox
\newlength{\foodim}
\newcommand{\slantbox}[2][0]{\mbox{%
        \sbox{\foobox}{#2}%
        \foodim=#1\wd\foobox
        \hskip \wd\foobox
        \hskip -0.5\foodim
        \pdfsave
        \pdfsetmatrix{1 0 #1 1}%
        \llap{\usebox{\foobox}}%
        \pdfrestore
        \hskip 0.5\foodim
}}
% \def\Loss{\slantbox[-.45]{$\mathscr{L}$}} % <-- Comment out or remove the old def
\DeclareRobustCommand{\Loss}{\slantbox[-.45]{$\mathscr{L}$}} % <-- Use this instead

% \def\Activation{\slantbox[-.45]{$\mathscr{A}$}} % <-- Comment out or remove the old def
\DeclareRobustCommand{\Activation}{\slantbox[-.45]{$\mathscr{A}$}} % <-- Use this instead

\usepackage{pdflscape}

\usepackage{imakeidx}
\makeindex[title=Índice Remissivo, intoc] % Cria o índice com título customizado e o adiciona ao sumário (intoc)

\usepackage[printonlyused, withpage]{acronym} % Opções recomendadas

\usepackage[toc, style=long]{glossaries} % 'toc' adds the glossary to your table of contents, which is usually nice.
\makeglossaries

% ===================================================================
% FIM DO PREÂMBULO
% ===================================================================